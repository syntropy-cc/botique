# Data Models Architecture

> **Document Type**: Cross-Cutting Concern (Level 2)
> **Parent**: [System Architecture](../../ARCHITECTURE.md)
> **Last Updated**: 2026-01-27
> **Version**: 1.0

## Purpose

This document defines the **Data Models** patterns, policies, and implementations that apply across all domains. Individual domains must comply with these standards and may extend them with domain-specific requirements.

## Scope

### What This Document Covers

- Data structure standards and JSON schemas
- Data flow between pipeline phases
- Validation requirements
- Template and library data structures

### What This Document Does NOT Cover

- Domain-specific business logic
- Implementation details within domains
- Infrastructure configuration

## Principles

### Principle 1: JSON as Standard Format

All inter-phase data exchange uses JSON format. This ensures:
- Human-readable debugging
- Language-agnostic processing
- Easy serialization/deserialization
- Version compatibility

**Application**: All pipeline outputs are JSON files, all briefs are JSON structures.

### Principle 2: Schema Evolution

Data structures can evolve, but must maintain backward compatibility during transition periods.

**Application**: New fields are added as optional, deprecated fields are marked but not removed immediately.

### Principle 3: Validation at Boundaries

All data structures are validated at phase boundaries before being passed to next phase.

**Application**: Each phase validates its output before proceeding, tools validate inputs before processing.

## Standards

### Standard DM-001: JSON Schema Definitions

**Requirement**: All major data structures must have documented JSON schemas with field descriptions, types, and constraints.

**Rationale**: Ensures consistency, enables validation, facilitates debugging.

**Implementation**:
- All schemas documented in this document
- Field types clearly specified (string, number, boolean, array, object)
- Required vs optional fields clearly marked
- Constraints documented (e.g., max_chars, value ranges)

**Verification**: Schema compliance checked during code review and validation gates.

### Standard DM-002: Data Flow Documentation

**Requirement**: All data structures must document their phase of creation, consuming phases, and transformation points.

**Rationale**: Enables understanding of data lifecycle and dependencies.

**Implementation**:
- Each structure documents: Phase, Generated By, Consumed By
- Data flow diagrams show transformations
- Cross-references to related structures

**Verification**: Data flow documented in this document and domain architecture documents.

## Data Structures

### 1. post_ideas.json

**Phase**: Phase 1 (Ideation)  
**Generated By**: Post Ideator (AI)  
**Consumed By**: Phase 2 (Configuration)

**Schema**:
```json
{
  "ideas": [
    {
      "id": "string",
      "platform": "string",
      "tone": "string",
      "persona": "string",
      "angle": "string",
      "hook": "string",
      "narrative_arc": "string",
      "key_insights_used": ["string"],
      "estimated_slides": "number",
      "confidence": "number"
    }
  ],
  "article_summary": {
    "main_thesis": "string",
    "key_insights": [
      {
        "id": "string",
        "content": "string",
        "type": "string",
        "strength": "number",
        "source_quote": "string (optional)"
      }
    ],
    "themes": ["string"]
  }
}
```

**Field Descriptions**:
- `ideas[]`: List of generated ideas
  - `id`: Unique idea identifier
  - `platform`: Target platform (linkedin, instagram, etc.)
  - `tone`: Tone (professional, casual, etc.)
  - `persona`: Target persona
  - `angle`: Unique idea angle
  - `hook`: Opening hook
  - `narrative_arc`: High-level narrative arc
  - `key_insights_used[]`: IDs of insights used
  - `estimated_slides`: Estimated number of slides
  - `confidence`: Idea confidence (0.0-1.0)
- `article_summary`: Article summary
  - `main_thesis`: Main thesis
  - `key_insights[]`: Key extracted insights
    - `id`: Unique insight ID
    - `content`: Insight content
    - `type`: Type (statistic, insight, quote, etc.)
    - `strength`: Insight strength (1-10)
    - `source_quote`: Source citation (optional)
  - `themes[]`: Identified themes

### 2. post_config.json

**Phase**: Phase 2 (Configuration)  
**Generated By**: Parameter Resolver (Code)  
**Consumed By**: Phase 3, 4, 5

**Schema**:
```json
{
  "post_id": "string",
  "idea_ref": "string",
  "platform": "string",
  "tone": "string",
  "persona": "string",
  "palette_id": "string",
  "typography_id": "string",
  "canvas": {
    "width": "number",
    "height": "number",
    "aspect_ratio": "string"
  },
  "brand": {
    "handle": "string",
    "tagline": "string"
  }
}
```

**Field Descriptions**:
- `post_id`: Unique post identifier
- `idea_ref`: Reference to source idea
- `platform`: Target platform
- `tone`: Tone
- `persona`: Target persona
- `palette_id`: Selected palette ID
- `typography_id`: Selected typography ID
- `canvas`: Canvas dimensions
  - `width`: Width in pixels
  - `height`: Height in pixels
  - `aspect_ratio`: Aspect ratio (e.g., "4:5")
- `brand`: Brand assets
  - `handle`: Brand handle (e.g., "@syntropy")
  - `tagline`: Brand tagline

### 3. coherence_brief.json

**Phase**: Phase 2-5 (Evolutionary)  
**Generated By**: Coherence Brief Builder + Agents (Code + AI)  
**Consumed By**: All phases 3-5

**Note**: Complete structure documented in [Memory Domain](../domains/memory/ARCHITECTURE.md). This section provides summary schema.

**Core Sections**:
- `metadata`: Post identification and format
- `voice`: Tone, personality, vocabulary, formality
- `visual`: Palette, typography, canvas, style, mood
- `emotions`: Primary, secondary, avoid emotions
- `content`: Keywords, themes, main message, angle, hook
- `audience`: Persona, pain points, desires
- `constraints`: Avoid topics, required elements
- `structure`: Objective, narrative arc, estimated slides
- `context`: Article context, key insights
- `brand`: Brand values and assets
- `evolution`: Narrative structure, copy guidelines, visual preferences, platform constraints

**Reference**: See [Memory Domain](../domains/memory/ARCHITECTURE.md) for complete structure.

### 4. narrative_structure.json

**Phase**: Phase 3 (Post Creation)  
**Generated By**: Narrative Architect (AI) + Template Selector (Code)  
**Consumed By**: Phase 4 (Slide Generation)

**Schema**:
```json
{
  "post_id": "string",
  "arc": "string",
  "narrative_pacing": "string",
  "transition_style": "string",
  "arc_refined": "string",
  "slides": [
    {
      "slide_number": "number",
      "template_type": "string",
      "value_subtype": "string (optional)",
      "template_id": "string",
      "template_justification": "string",
      "template_confidence": "number",
      "purpose": "string",
      "target_emotions": ["string"],
      "copy_direction": "string",
      "key_elements": ["string"],
      "content_slots": {
        "headline": {"max_chars": "number"},
        "subtitle": {"max_chars": "number (optional)"},
        "body": {"max_chars": "number (optional)"}
      },
      "insights_referenced": ["string (optional)"]
    }
  ],
  "rationale": {
    "pacing_choice": "string",
    "transition_style": "string",
    "emotional_arc": "string"
  }
}
```

**Field Descriptions**:
- `post_id`: Post identifier
- `arc`: Narrative arc (high level)
- `narrative_pacing`: Pacing ("fast", "moderate", "deliberate")
- `transition_style`: Transition style ("abrupt", "smooth", "dramatic")
- `arc_refined`: Refined narrative arc
- `slides[]`: List of slides
  - `slide_number`: Slide number (1-indexed)
  - `template_type`: Template type ("hook", "value", "cta", "transition")
  - `value_subtype`: Value subtype ("data", "insight", "solution", "example") - only for `template_type="value"`
  - `template_id`: Specific template ID (added by Template Selector)
  - `template_justification`: Selection justification (added by Template Selector)
  - `template_confidence`: Selection confidence 0.0-1.0 (added by Template Selector)
  - `purpose`: Slide purpose
  - `target_emotions[]`: Target emotions
  - `copy_direction`: Copy direction (50-300 words)
  - `key_elements[]`: Key elements
  - `content_slots{}`: Content slots with constraints
  - `insights_referenced[]`: Referenced insight IDs (optional)
- `rationale`: Decision justification (optional)

### 5. slide_content.json

**Phase**: Phase 4 (Slide Generation)  
**Generated By**: Copywriter (AI)  
**Consumed By**: Phase 4 (Image Compositor)

**Schema**:
```json
{
  "slides": [
    {
      "slide_number": "number",
      "title": {
        "content": "string",
        "emphasis": ["string"]
      },
      "subtitle": {
        "content": "string",
        "emphasis": ["string"]
      },
      "body": {
        "content": "string",
        "emphasis": ["string"]
      }
    }
  ]
}
```

**Field Descriptions**:
- `slides[]`: List of content per slide
  - `slide_number`: Slide number
  - `title`: Slide title
    - `content`: Title text
    - `emphasis[]`: List of words/phrases to emphasize
  - `subtitle`: Subtitle (optional)
    - `content`: Subtitle text
    - `emphasis[]`: List of words/phrases to emphasize
  - `body`: Body text (optional)
    - `content`: Body text
    - `emphasis[]`: List of words/phrases to emphasize

**Note**: Copywriter generates content for **ALL slides** in single LLM call to ensure coherence.

### 6. visual_specs.json

**Phase**: Phase 4 (Slide Generation)  
**Generated By**: Visual Composer (AI)  
**Consumed By**: Phase 4 (Image Compositor)

**Schema**:
```json
{
  "slide_number": "number",
  "background": {
    "type": "string",
    "colors": ["string"],
    "direction": "string",
    "image_url": "string (optional)"
  },
  "elements": [
    {
      "type": "string",
      "position": {"x": "number", "y": "number"},
      "color": "string",
      "intensity": "number (optional)",
      "radius": "number (optional)",
      "opacity": "number (optional)",
      "shape": "string (optional)"
    }
  ]
}
```

**Field Descriptions**:
- `slide_number`: Slide number
- `background`: Background specification
  - `type`: Type ("gradient", "solid", "image")
  - `colors[]`: List of colors (for gradient)
  - `direction`: Gradient direction ("vertical", "horizontal", "radial")
  - `image_url`: Image URL (if type="image")
- `elements[]`: List of visual elements
  - `type`: Type ("glow", "shape", "line", etc.)
  - `position`: Position {x: int, y: int}
  - `color`: Color in hex
  - `intensity`: Intensity 0.0-1.0 (for glow)
  - `radius`: Radius in pixels (for glow/shape)
  - `opacity`: Opacity 0.0-1.0
  - `shape`: Shape ("circle", "rectangle", etc.) - for type="shape"

**Note**: Visual Composer generates design **WITHOUT text**. Text is added later by Image Compositor.

### 7. text_overlay.json

**Phase**: Phase 4 (Slide Generation)  
**Generated By**: Prompt Builder (Text) (Code)  
**Consumed By**: Phase 4 (Image Compositor)

**Schema**:
```json
{
  "slide_number": "number",
  "texts": [
    {
      "slot": "string",
      "content": "string",
      "position": {"x": "number", "y": "number"},
      "font": "string",
      "size": "number",
      "color": "string",
      "alignment": "string",
      "emphasis": [
        {
          "text": "string",
          "color": "string"
        }
      ]
    }
  ]
}
```

**Field Descriptions**:
- `slide_number`: Slide number
- `texts[]`: List of texts to render
  - `slot`: Layout slot ("headline", "subtitle", "body")
  - `content`: Text to render
  - `position`: Position {x: int, y: int}
  - `font`: Font name
  - `size`: Font size in pixels
  - `color`: Base color in hex
  - `alignment`: Alignment ("left", "center", "right")
  - `emphasis[]`: List of emphases
    - `text`: Text to emphasize
    - `color`: Emphasis color in hex

### 8. caption.json

**Phase**: Phase 5 (Finalization)  
**Generated By**: Caption Writer (AI)  
**Consumed By**: Final output

**Schema**:
```json
{
  "platform": "string",
  "full_caption": "string",
  "character_count": "number",
  "hashtags": ["string"],
  "mentions": ["string (optional)"]
}
```

**Field Descriptions**:
- `platform`: Target platform
- `full_caption`: Complete caption
- `character_count`: Character count
- `hashtags[]`: List of suggested hashtags
- `mentions[]`: List of mentions (optional)

### 9. validation_report.json

**Phase**: Phase 5 (Finalization)  
**Generated By**: Quality Validator (Code)  
**Consumed By**: Final output

**Schema**:
```json
{
  "post_id": "string",
  "score": "number",
  "breakdown": {
    "coherence": "number",
    "visual": "number",
    "textual": "number",
    "completeness": "number"
  },
  "passed": "boolean",
  "warnings": ["string"],
  "errors": ["string"]
}
```

**Field Descriptions**:
- `post_id`: Post identifier
- `score`: Overall score (0.0-1.0)
- `breakdown{}`: Breakdown by category
  - `coherence`: Coherence score
  - `visual`: Visual score
  - `textual`: Textual score
  - `completeness`: Completeness score
- `passed`: Whether validation passed (boolean)
- `warnings[]`: List of warnings
- `errors[]`: List of errors

## Template and Library Structures

### TextualTemplate

**Location**: `src/templates/textual_templates.py`

**Schema**:
```python
TextualTemplate(
    id="string",                    # Unique identifier
    module_type="string",           # Category
    function="string",              # Purpose description
    structure="string",             # Text pattern with placeholders
    length_range=(min, max),        # Character limits
    tone="string",                  # Recommended tone
    example="string",               # Usage example
    keywords=["string"],            # Keywords for matching
    semantic_description="string"   # Semantic description for embedding matching
)
```

**Field Descriptions**:
- `id`: Unique template ID (e.g., "H_CONTRASTE")
- `module_type`: Module type ("hook", "valor_dado", "valor_insight", "valor_solucao", "valor_exemplo", "cta", "transition")
- `function`: Purpose description
- `structure`: Text pattern with placeholders (e.g., "[Before] vs. [After]")
- `length_range`: Tuple (min, max) of characters
- `tone`: Recommended tone
- `example`: Usage example
- `keywords[]`: List of keywords for matching
- `semantic_description`: Semantic description for embedding matching

**Total**: 46 predefined templates

### Palette Structure

**Location**: `libraries/palettes/`

**Schema**:
```json
{
  "palette_id": {
    "theme": "string",
    "primary": "string",
    "accent": "string",
    "cta": "string",
    "background": "string",
    "text": "string",
    "text_secondary": "string"
  }
}
```

### Typography Structure

**Location**: `libraries/typography/`

**Schema**:
```json
{
  "typography_id": {
    "heading_font": "string",
    "body_font": "string",
    "sizes": {
      "heading": "number",
      "subtitle": "number",
      "body": "number"
    },
    "line_height": "number"
  }
}
```

### Layout Structure

**Location**: `libraries/layouts/`

**Schema**:
```json
{
  "layout_id": {
    "slots": [
      {
        "name": "string",
        "position": {"x": "number", "y": "number"},
        "max_chars": "number",
        "alignment": "string"
      }
    ]
  }
}
```

## Data Flow

### Phase-to-Phase Data Flow

```
Article (text)
  ↓
Phase 1: post_ideas.json
  ↓
Phase 2: coherence_brief.json (initial), post_config.json
  ↓
Phase 3: narrative_structure.json, narrative_structure_enriched.json
  ↓
Phase 4: slide_content.json, visual_specs.json, text_overlay.json, final_slide.png (per slide)
  ↓
Phase 5: caption.json, validation_report.json
  ↓
Complete Output Directory
```

## Validation Requirements

### Phase 1 Validation
- ≥3 ideas generated?
- Ideas distinct?
- All required fields present?

### Phase 2 Validation
- Config complete?
- Brief valid? (required fields present)
- Palette and typography selected?

### Phase 3 Validation
- ≥5 slides? (or 1 for single_image)
- Logical arc?
- All slides have `template_type`?
- Value slides have `value_subtype`?
- All slides have `template_id`? (after Template Selector)
- Confidence >0.5? (after Template Selector)

### Phase 4 Validation
- Text within limits?
- Text follows template structure?
- Design without text?
- Correct dimensions?
- Text readable?

### Phase 5 Validation
- Caption size OK?
- Score >0.7?
- All files present?

## Domain Integration

### Required Integration Points

Every domain MUST:
1. Use documented JSON schemas for data exchange
2. Validate data structures at boundaries
3. Document any domain-specific extensions to standard structures

### Integration Checklist

For each domain, verify:
- [ ] Uses standard JSON schemas for inter-domain communication
- [ ] Validates inputs against schemas
- [ ] Documents any schema extensions
- [ ] Follows data flow patterns

## Related Documents

- [System Architecture](../../ARCHITECTURE.md) - Root architecture document
- [Memory Domain](../domains/memory/ARCHITECTURE.md) - Coherence Brief complete structure
- [Pipeline Domain](../domains/pipeline/ARCHITECTURE.md) - How data flows through phases
- [Agents Domain](../domains/agents/ARCHITECTURE.md) - Agents that generate these structures
- [Tools Domain](../domains/tools/ARCHITECTURE.md) - Tools that process these structures
